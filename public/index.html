<!DOCTYPE html>
<html class="h-full">
<head>
    <meta charset="UTF-8">
    <title>SK-Client Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @font-face { font-family: 'Minecraft'; src: url('https://db.onlinewebfonts.com/t/6ab539c6fc2b21ff0b149b3d06d7f97c.woff2') format('woff2'); }
        body { background: #111; color: white; font-family: 'Minecraft', sans-serif; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .tab-btn.active { color: #60a5fa; border-bottom: 3px solid #60a5fa; }
        .slot { width: 44px; height: 44px; background: #8b8b8b; border: 2px solid #373737; border-top-color: #FFF; border-left-color: #FFF; position: relative; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .pixelated { image-rendering: pixelated; }
        #chat-box span { font-family: sans-serif; font-size: 14px; }
        .tooltip { position: fixed; background: rgba(16,0,16,0.95); border: 2px solid #2d006b; padding: 8px; pointer-events: none; z-index: 999; display: none; }
    </style>
</head>
<body class="h-full">
    <div id="tooltip" class="tooltip"></div>
    <div class="h-14 bg-gray-900 border-b-4 border-gray-700 flex items-center justify-between px-6 flex-shrink-0">
        <div class="flex space-x-6 h-full">
            <button onclick="setTab('account')" id="btn-account" class="tab-btn active font-bold">ACCOUNT</button>
            <button onclick="setTab('inventory')" id="btn-inventory" class="tab-btn font-bold">INV</button>
            <button onclick="setTab('chat')" id="btn-chat" class="tab-btn font-bold">CHAT</button>
            <button onclick="setTab('world')" id="btn-world" class="tab-btn font-bold">RADAR</button>
        </div>
        <div id="session-timer" class="text-green-500 font-mono text-xl">00:00:00</div>
    </div>
    <div class="flex-1 relative overflow-hidden bg-[#1a1a1a]">
        <div id="tab-account" class="tab-content h-full flex items-center justify-center">
            <div class="bg-gray-800 p-8 border-4 border-gray-600 space-y-4 w-96">
                <input id="host" class="w-full bg-black p-3 border border-gray-500" placeholder="IP">
                <input id="port" class="w-full bg-black p-3 border border-gray-500" value="25565">
                <input id="user" class="w-full bg-black p-3 border border-gray-500" value="SK_Bot">
                <button onclick="connect()" class="w-full bg-blue-700 py-3 font-bold border-b-4 border-blue-900">JOIN</button>
            </div>
        </div>
        <div id="tab-inventory" class="tab-content hidden h-full overflow-y-auto p-6 flex flex-col items-center">
            <h2 id="window-title" class="text-yellow-400 mb-4 text-xl">Inventory</h2>
            <div class="flex gap-4 mb-6"><div id="armor-row" class="flex gap-1"></div><div id="offhand-slot" class="slot border-yellow-500 ml-4"></div></div>
            <div class="bg-[#c6c6c6] p-2 border-4 border-[#555] shadow-xl"><div id="inv-storage" class="grid grid-cols-9 gap-1"></div></div>
            <div class="bg-[#c6c6c6] p-2 border-4 border-[#555] shadow-xl mt-4"><div id="inv-hotbar" class="grid grid-cols-9 gap-1"></div></div>
        </div>
        <div id="tab-chat" class="tab-content hidden h-full flex overflow-hidden">
            <div class="flex-1 flex flex-col h-full bg-black/40">
                <div id="chat-box" class="flex-1 overflow-y-auto p-4 space-y-1"></div>
                <input id="chat-input" class="bg-black p-4 border-t border-gray-700 outline-none w-full" placeholder="Type message...">
            </div>
            <div id="player-list" class="w-64 border-l border-gray-800 bg-black/60 p-4 overflow-y-auto"></div>
        </div>
        <div id="tab-world" class="tab-content hidden h-full flex flex-col items-center justify-center">
            <canvas id="world-canvas" width="500" height="500" class="border-4 border-gray-800 bg-black cursor-crosshair"></canvas>
            <div id="coords" class="mt-2 text-blue-400 font-mono">XYZ: 0 0 0</div>
        </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const canvas = document.getElementById('world-canvas');
        const ctx = canvas.getContext('2d');
        let lastData = null;

        function getTexture(item, ver) {
            if (item.headOwner) return `https://mc-heads.net/avatar/${item.headOwner}/32`;
            let n = item.name;
            let folder = "item";

            // Texture Force-Mappings
            if (n === 'piston') { n = 'piston_top'; folder = 'block'; }
            else if (n === 'sticky_piston') { n = 'piston_top_sticky'; folder = 'block'; }
            else if (n === 'observer') { n = 'observer_front'; folder = 'block'; }
            else if (n === 'quartz_block') { n = 'quartz_block_top'; folder = 'block'; }
            else if (n === 'dirt' || n === 'end_stone') { folder = 'block'; }
            else if (n === 'warped_stem') { n = 'warped_stem_top'; folder = 'block'; }
            else if (n.includes('glass_pane')) {
                let color = n.replace('_glass_pane', '');
                n = (color === 'glass_pane' ? 'glass' : color + '_stained_glass');
                folder = 'block';
            }

            const url = `https://assets.mcasset.cloud/${ver}/assets/minecraft/textures/${folder}/${n}.png`;
            return url;
        }

        canvas.onclick = (e) => {
            if (!lastData) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left - 250) / 14;
            const z = (e.clientY - rect.top - 250) / 14;
            socket.emit('move-to', { x: lastData.pos.x + x, z: lastData.pos.z + z });
        };

        socket.on('bot-update', (data) => {
            lastData = data;
            const ver = data.version || "1.20.1";
            document.getElementById('coords').textContent = `XYZ: ${Math.floor(data.pos.x)} / ${Math.floor(data.pos.y)} / ${Math.floor(data.pos.z)}`;
            document.getElementById('window-title').textContent = data.windowTitle;

            if (!document.getElementById('tab-world').classList.contains('hidden')) {
                ctx.fillStyle = '#050505'; ctx.fillRect(0,0,500,500);
                data.world.forEach(b => {
                    ctx.fillStyle = b.name.includes('grass') ? '#5d9948' : b.name.includes('water') ? '#1346a3' : b.name.includes('stone') ? '#7c7c7c' : b.name.includes('sand') ? '#dbd3a0' : (b.name.includes('wood') || b.name.includes('log') || b.name.includes('stem')) ? '#4b3923' : '#333';
                    ctx.fillRect((b.x - data.pos.x)*14 + 250, (b.z - data.pos.z)*14 + 250, 13, 13);
                });
                ctx.fillStyle='red'; ctx.fillRect(247,247,6,6);
            }

            const plist = document.getElementById('player-list');
            plist.innerHTML = '<div class="text-yellow-500 mb-2 border-b border-gray-700">PLAYERS</div>';
            data.players.forEach(p => {
                plist.innerHTML += `<div class="flex items-center gap-2 mb-2 text-sm"><img src="https://mc-heads.net/avatar/${p.name}/16" class="w-4 h-4"><span>${p.name}</span></div>`;
            });

            const render = (id, items) => {
                const el = document.getElementById(id);
                items.forEach((item, idx) => {
                    let d = el.children[idx] || document.createElement('div');
                    if (!el.children[idx]) { d.className = 'slot'; el.appendChild(d); }
                    if (d.dataset.key === `${item.name}-${item.count}-${item.displayName}`) return;
                    d.dataset.key = `${item.name}-${item.count}-${item.displayName}`;
                    d.innerHTML = '';
                    if (item.name) {
                        const img = document.createElement('img');
                        img.className = "w-8 h-8 pixelated";
                        img.src = getTexture(item, ver);
                        // Double fallback: if item fails, try block. If block fails, try barrier.
                        img.onerror = () => { 
                            if (!img.src.includes('/block/')) {
                                img.src = img.src.replace('/item/', '/block/');
                            } else {
                                img.src = `https://assets.mcasset.cloud/${ver}/assets/minecraft/textures/item/barrier.png`;
                            }
                        };
                        d.appendChild(img);
                        if (item.count > 1) d.innerHTML += `<div class="absolute bottom-0 right-1 text-[11px] drop-shadow-md font-bold">${item.count}</div>`;
                        d.onmouseenter = () => { 
                            const tt = document.getElementById('tooltip'); tt.style.display = 'block'; 
                            tt.innerHTML = `<div class="text-[#FF55FF]">${item.displayName}</div><div class="text-gray-500 text-[10px]">${item.rawName}</div>`;
                        };
                        d.onmousemove = (e) => { const tt = document.getElementById('tooltip'); tt.style.left = (e.clientX + 15) + 'px'; tt.style.top = (e.clientY + 15) + 'px'; };
                        d.onmouseleave = () => document.getElementById('tooltip').style.display = 'none';
                    }
                    d.onclick = (e) => socket.emit('click', { slot: item.slot, shift: e.shiftKey });
                });
            };
            render('inv-storage', data.storage); render('inv-hotbar', data.hotbar); render('armor-row', data.armor);
            const oh = document.getElementById('offhand-slot');
            if (data.offhand.name && oh.dataset.key !== data.offhand.name) {
                oh.innerHTML = `<img src="${getTexture(data.offhand, ver)}" class="w-8 h-8 pixelated">`; oh.dataset.key = data.offhand.name;
            } else if (!data.offhand.name) { oh.innerHTML = ''; oh.dataset.key = ''; }
        });

        socket.on('log', (m) => {
            const b = document.getElementById('chat-box');
            let t = m.text.replace(/ยง#([A-Fa-f0-9]{6})/g, '</span><span style="color:#$1">');
            t = t.replace(/\[#?([A-Fa-f0-9]{6})[A-Fa-f0-9]{0,2}\]/g, '</span><span style="color:#$1">');
            const cols = {'0':'#000','1':'#00A','2':'#0A0','3':'#0AA','4':'#A00','5':'#A0A','6':'#FA0','7':'#AAA','8':'#555','9':'#55F','a':'#5F5','b':'#5FF','c':'#F55','d':'#F5F','e':'#FF5','f':'#FFF','r':'#FFF'};
            t = t.replace(/ยง([0-9a-fk-or])/gi, (match, code) => {
                const c = code.toLowerCase();
                return cols[c] ? `</span><span style="color:${cols[c]}">` : "";
            });
            t = t.replace(/\[?ยง#\]?/g, "");
            const d = document.createElement('div'); d.innerHTML = '<span>' + t + '</span>';
            b.appendChild(d); b.scrollTop = b.scrollHeight;
        });

        setInterval(() => {
            if (!lastData?.sessionStart) return;
            const s = Math.floor((Date.now() - lastData.sessionStart) / 1000);
            document.getElementById('session-timer').textContent = new Date(s * 1000).toISOString().substr(11, 8);
        }, 1000);

        function setTab(t) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById('tab-'+t).classList.remove('hidden');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-'+t).classList.add('active');
        }
        function connect() { socket.emit('join', { host: document.getElementById('host').value, port: document.getElementById('port').value, username: document.getElementById('user').value }); setTab('chat'); }
        document.getElementById('chat-input').onkeydown = (e) => { if (e.key === 'Enter') { socket.emit('chat', e.target.value); e.target.value = ''; } };
    </script>
</body>
</html>
